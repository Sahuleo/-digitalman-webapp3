<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>پاکسازی کش و سرویس‌ورکر</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,Tahoma;background:#0f0f12;color:#f5f5f7;margin:0;padding:24px}
    .card{background:#17171b;border:1px solid #2b2b33;border-radius:12px;padding:16px;max-width:720px}
    button{padding:10px 14px;border-radius:8px;border:1px solid #333;background:#5b44c7;color:#fff;cursor:pointer}
    code{background:#111217;border:1px solid #2b2b33;border-radius:6px;padding:2px 6px}
    .ok{color:#81c784}.bad{color:#e57373}
  </style>
</head>
<body>
  <div class="card">
    <h1>پاکسازی کش و سرویس‌ورکر</h1>
    <p>این صفحه همهٔ کش‌های اپ را حذف و Service Worker را لغو ثبت می‌کند.</p>
    <button id="doPurge">پاکسازی الان</button>
    <div id="log" style="margin-top:12px"></div>
  </div>
<script>
document.getElementById('doPurge').addEventListener('click', async ()=>{
  const log = msg=> document.getElementById('log').innerHTML += msg + '<br>';
  try{
    if ('caches' in window){
      const keys = await caches.keys();
      for(const k of keys){ await caches.delete(k); log('حذف کش: <code>'+k+'</code>'); }
    }
    if ('serviceWorker' in navigator){
      const regs = await navigator.serviceWorker.getRegistrations();
      for(const r of regs){ await r.unregister(); log('لغو Service Worker انجام شد'); }
    }
    log('<span class="ok">تمام شد. صفحه را رفرش کنید.</span>');
  }catch(e){
    log('<span class="bad">خطا: '+(e.message||e)+'</span>');
  }
});
</script>
</body>
</html>
